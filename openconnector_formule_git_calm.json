{"id":58334,"name":"formule_git_calm","userId":249369,"accountId":105691,"createdDate":"2021-07-27T12:57:44Z","steps":[{"id":555230,"onSuccess":[],"onFailure":[],"name":"calm","type":"elementRequest","properties":{"api":"/tasks/${config.taskId}","body":"${config.body}","method":"PATCH","elementInstanceId":"${config.calm}"}},{"id":555231,"onSuccess":[],"onFailure":[],"name":"calm2","type":"elementRequest","properties":{"api":"/tasks","method":"PATCH","elementInstanceId":"${config.calm}"}},{"id":555234,"onSuccess":[],"onFailure":[],"name":"error","type":"elementRequest","properties":{"api":"/tasks","method":"PUT","elementInstanceId":"${config.git}"}},{"id":555235,"onSuccess":[],"onFailure":[],"name":"error2","type":"elementRequest","properties":{"api":"/tasks","method":"GET","elementInstanceId":"${config.git}"}},{"id":568861,"onSuccess":["success"],"onFailure":[],"name":"errrror","type":"elementRequest","properties":{"api":"/tasks/${config.taskId}","method":"POST","elementInstanceId":"${config.git}"}},{"id":568189,"onSuccess":["error2"],"onFailure":[],"name":"failure","type":"script","properties":{"body":"notify.email(\"souraya.idrissi@sap.com\" , \"FAILURE\" , \"failure\");\n"}},{"id":555229,"onSuccess":["calm"],"onFailure":[],"name":"parse","type":"script","properties":{"body":"//retrieve data\r\n// action\r\nlet action = JSON.stringify(trigger.body.message.raw.action);\r\nconsole.log(\"action is:\" + action);\r\n\r\n//if (action == \"\\\"edited\\\"\" || action ==  \"\\\"opened\\\"\"  || action ==  \"\\\"reopened\\\"\"  || action ==  \"\\\"closed\\\"\" ) {done(\"The operation can be supported\");}\r\n//else {\r\n//  done(\"The operation can not be supported\");}\r\n\r\n//title modified\r\nlet str_title_modified = JSON.stringify(trigger.body.message.raw.issue.title);\r\nstr_title_modified = str_title_modified.slice(1, -1);\r\n\r\n//assignees\r\nlet assignees = JSON.stringify(trigger.body.message.raw.issue.assignees.login);\r\nconsole.log(\"assignees \" + assignees);\r\n\r\n// id\r\nlet externalId = JSON.stringify(trigger.body.message.raw.issue.id);\r\nconsole.log(\"externalId \" + externalId);\r\n\r\n//due_on\r\nlet due_on = JSON.stringify(trigger.body.message.raw.issue.milestone.due_on);\r\ndue_on = due_on.slice(1, -11);\r\nconsole.log(\"due_on \" + due_on );\r\n\r\n// state\r\nlet state = JSON.stringify(trigger.body.message.raw.issue.state);\r\nconsole.log(\"state \" + state );\r\n\r\n//calm status\r\nlet calm_status = \"\";\r\nif (state == \"\\\"open\\\"\") {calm_status = \"CIPTKINP\";}\r\nif (state ==\"\\\"closed\\\"\") {calm_status = \"CIPTKCLOSE\";}\r\nconsole.log(\"calm_status \" + calm_status );\r\n\r\n// description\r\nlet description = JSON.stringify(trigger.body.message.raw.issue.body);\r\ndescription = description.slice(32, -1);\r\nconsole.log(\"description \" + description );\r\n\r\n// calmId\r\nlet calmId = JSON.stringify(trigger.body.message.raw.issue.body);\r\ncalmId = calmId.slice(32, -1);\r\nconsole.log(\"calmId \" + calmId);\r\n\r\n//creation of an object which contain all the variable (body) of a task \r\nconst request = {\r\n  \"title\": str_title_modified,\r\n  \"status\": calm_status,\r\n  \"externalId\": externalId,\r\n  \"dueDate\": due_on,\r\n  \"description\": calmId\r\n};\r\n\r\n//calmId and request can be accessible by using config \r\nconfig.body = request;\r\nconfig.taskId = calmId;\r\n\r\n\r\n"}},{"id":568188,"onSuccess":["error"],"onFailure":[],"name":"success","type":"script","properties":{"body":"notify.email(\"souraya.idrissi@sap.com\", \"SUCCESS\", \" success\");\n\n"}}],"triggers":[{"id":49406,"onSuccess":["parse"],"onFailure":[],"type":"event","async":true,"active":true,"name":"trigger","properties":{"elementInstanceId":"${config.git}"}},{"id":49405,"onSuccess":["parse"],"onFailure":[],"type":"manual","async":true,"active":false,"name":"trigger","properties":{}}],"engine":"v3","active":true,"debugLoggingEnabled":false,"singleThreaded":false,"configuration":[{"id":97039,"key":"body","name":"body","type":"value","required":false},{"id":97037,"key":"calm","name":"calm","type":"elementInstance","required":true},{"id":97038,"key":"git","name":"git","type":"elementInstance","required":true},{"id":97040,"key":"taskId","name":"taskId","type":"value","required":false}]}